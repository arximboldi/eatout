function toSlug(e){return e.toLowerCase().replace(/-+/g,"").replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}var eob_app=angular.module("eob.app",["ngAnimate","ngRoute","eob.controllers","eob.directives","eob.services"]);eob_app.config(function(e){e.when("/",{templateUrl:"templates/empty.html",controller:"eob_NoPlaceUrlCtrl"}).when("/place/:placeSlug",{templateUrl:"templates/empty.html",controller:"eob_PlaceUrlCtrl"}).otherwise({redirectTo:"/"})}),eob_app.config(function(e){e.html5Mode(!0)}),eob_app.run(["$route",angular.noop]);var eob_controllers=angular.module("eob.controllers",[]),DROP_DELAY=200,BERLIN_POS=new google.maps.LatLng(52.5096315,13.4018519),MARKER_ICONS={pizza:"images/icons/SVG/pizza.svg",beer:"images/icons/SVG/beer.svg",viet:"images/icons/SVG/ramen.svg",burger:"images/icons/SVG/burger.svg",japan:"images/icons/SVG/sushi.svg",breakfast:"images/icons/SVG/coffee.svg",icecream:"images/icons/SVG/icecream.svg",german:"images/icons/SVG/german.svg",muffin:"images/icons/SVG/muffin.svg",french:"images/icons/SVG/french.svg",egg:"images/icons/SVG/spanish.svg",sandwich:"images/icons/SVG/sandwich.svg"},MARKER_ICONS2={pizza:"images/icons/pizza.png",beer:"images/icons/beer.png",viet:"images/icons/viet.png",burger:"images/icons/burger.png",japan:"images/icons/japan.png",breakfast:"images/icons/breakfast.png",croissant:"images/icons/croissant.png",cheese:"images/icons/cheese.png",icecream:"images/icons/icecream.png",german:"images/icons/cburst.png",muffin:"images/icons/wmuffin.png",french:"images/icons/poulet.png",egg:"images/icons/egg.png"},MAP_STYLES=[{stylers:[{hue:"#5ebf64"},{saturation:-20}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:100},{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"all",stylers:[{color:"#ff1526"},{weight:.4}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#05C7F2"}]},{featureType:"landscape",stylers:[{hue:"#FFB20E"},{saturation:20}]},{featureType:"transit.line",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"label",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"off"}]}];eob_controllers.controller("eob_WeatherCtrl",function(e,n){n.getWeather(e)}),eob_controllers.controller("eob_MenuCtrl",function(e,n,o){o.districtsPromise.success(function(n){e.districts=n}),e.foodTypes=Object.keys(MARKER_ICONS),e.allChecked=!0,e.foodTypeChecked={},e.menuFindMe=function(){n.path("/"),e.findMe()},e.menuSelectAll=function(){e.allChecked=!0,e.foodTypeChecked={},e.filterMarkers(e.foodTypes)},e.menuSelectFoodType=function(n){e.allChecked=!1,e.foodTypeChecked[n]=!e.foodTypeChecked[n],e.filterMarkers(_.filter(e.foodTypes,function(n){return e.foodTypeChecked[n]}))},e.menuSelectDistrict=function(n){e.active="",e.centerPosition(n.lat,n.lng,n.zoom)},e.toggleItem=function(n){e.active=e.active==n?"":n},e.isActive=function(n){return e.active==n}}),eob_controllers.controller("eob_MapCtrl",function(e,n,o,t,i,a){function r(n){if(null==n&&(n=0),n>=0&&n<e.places.length){var t=e.places[n];a.load(_.pick(MARKER_ICONS,t.foodtype)).then(function(){var i=new google.maps.Marker({position:new google.maps.LatLng(t.lat,t.lng),map:l,icon:MARKER_ICONS[t.foodtype],animation:google.maps.Animation.DROP});c.push(i),google.maps.event.addListener(i,"click",function(){o.path("/place/"+t.slug),e.$apply()}),setTimeout(_.partial(r,n+1),DROP_DELAY)})}}function s(e){for(var n=new google.maps.LatLngBounds,o=0;o<e.length;o++)1==e[o].getVisible()&&n.extend(e[o].getPosition());l.fitBounds(n)}a.load(MARKER_ICONS),e.seemenu=!0,e.seepanel=!1,e.place=null,e.hidePanel=function(){e.seepanel=!1},e.showPanel=function(){e.seepanel=!0},e.hideMenu=function(){e.seemenu=!1},e.showMenu=function(){e.seemenu=!0},e.toggleMenu=function(){e.seemenu=!e.seemenu},e.setPlace=function(n){e.place=n},e.centerPosition=function(n,o,t){var i=new google.maps.LatLng(n,o);e.seepanel||e.seemenu?setTimeout(function(){var n=document.getElementById("map-canvas").offsetWidth,o=e.seepanel?document.getElementById("main-panel").offsetWidth:0,a=e.seemenu?document.getElementById("main-menu").offsetWidth:0;o>=n&&(o=0);var r=o/2-a/2;l.panTo(i),l.setZoom(t),l.panBy(r,0)},0):(l.panTo(i),l.setZoom(t))},e.findMe=function(){i.getCurrentPosition(function(e){a.load(_.pick(MARKER_ICONS,"findme")).then(function(){var n=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);null!=u&&(c.splice(c.indexOf(u),1),u.setMap(null)),u=new google.maps.Marker({map:l,position:n,icon:"images/SVG/iamhere.svg",animation:google.maps.Animation.DROP,zIndex:99999}),c.push(u);var o=(google.maps.geometry.spherical.computeDistanceBetween(n,BERLIN_POS)/1e3).toFixed(2);console.log("Distance to Berlin:",o),s(c)})})},t.placesPromise.success(function(n){e.places=n});var l=new google.maps.Map(document.getElementById("map-canvas"),{center:BERLIN_POS,zoom:13,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:MAP_STYLES}),c=[],u=null;e.filterMarkers=function(e){_.map(c,function(n){var o=null!=_.find(e,function(e){return n.getIcon()==MARKER_ICONS[e]});n.setVisible(o)})},google.maps.event.addListenerOnce(l,"tilesloaded",function(){t.placesPromise.then(_.partial(r,0))})}),eob_controllers.controller("eob_PlaceCtrl",function(e,n,o){function t(e){return n.protocol()+"://"+n.host()+"/"+e}var i=function(e){return"I found delicious "+e.foodtype+" at "+e.name+" via #EatOutBerlin"},a=function(){var t=e.place;if(t){var a=i(t);return"http://twitter.com/share?text="+o.encodeURIComponent(a)+"&url="+n.absUrl()}return""};e.twitterShare=function(){o.open(a(),"height=450, width=550, top="+(o.innerHeight/2-225)+", left="+(o.innerWidth/2-275)+", toolbar=0, location=0, menubar=0, directories=0, scrollbars=0")},e.facebookShare=function(){var o=e.place;if(o){{i(o)}FB.ui({method:"feed",link:n.absUrl(),picture:t(o.images[0]),name:"Eat Out Berlin: "+o.name,description:o.description},function(){})}}}),eob_controllers.controller("eob_PlaceUrlCtrl",function(e,n,o){o.placesPromise.success(function(o){var t=_.findWhere(o,{slug:n.placeSlug});null!=t?(e.setPlace(t),e.showPanel(),e.centerPosition(t.lat,t.lng,16)):alert("Place not found: "+n.placeSlug)})}),eob_controllers.controller("eob_NoPlaceUrlCtrl",function(e){e.hidePanel()});var eob_directives=angular.module("eob.directives",[]);eob_directives.directive("eob-dropdown",function(){return function(e,n){n.on("click",function(){n.parent().hasClass("open")?n.parent().removeClass("open"):n.parent().addClass("open")})}}).directive("eob_markdown",function(){var e=new Showdown.converter;return{restrict:"E",link:function(n,o){var t=e.makeHtml(o.text());o.html(t)}}});var eob_services=angular.module("eob.services",[]);eob_services.factory("eob_imgCache",function(e){function n(n){var o=e.defer(),t=new Image;return t.src=n,t.onload=function(){o.resolve(t)},t.onerror=function(){o.reject(t)},o}var o={};return{load:function(t){var i={};for(var a in t){var r=o[a];null==r&&(r=o[a]=n(t[a])),i[a]=r}return e.all(i)}}}),eob_services.factory("eob_geolocation",function(){var e={getCurrentPosition:function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,function(){alert("Geolocation failed!")}):alert("Geolocation not supported by your browser!")}};return e}),eob_services.factory("eob_data",function(e,n){var o={};return o.placesPromise=e.get("data/places.json").success(function(e){e.sort(function(e,n){return n.lat-e.lat}),e.forEach(function(e){e.slug=toSlug(e.name)}),o.places=e}),o.districtsPromise=e.get("data/districts.json").success(function(e){o.districts=e}),o.promise=n.all([o.placesPromise,o.districtsPromise]),o}),eob_services.factory("eob_weather",["$http",function(e){var n="http://query.yahooapis.com/v1/public/yql?q=",o="select * from weather.forecast where location='",t="'and u='c'&format=json",i="GMXX0007";return{getWeather:function(a){var r=n+o+i+t;e.get(r).success(function(e){a.weather=e,a.temp=e.query.results.channel.item.condition.temp,a.wcode=e.query.results.channel.item.condition.code})}}}]);